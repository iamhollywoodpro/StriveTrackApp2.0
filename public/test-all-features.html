<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StriveTrack Complete Feature Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-lg shadow p-6">
        <h1 class="text-3xl font-bold mb-6 text-blue-600">ğŸ§ª StriveTrack Complete Feature Test</h1>
        <p class="text-gray-600 mb-6">Testing ALL features with the new Cloudflare system</p>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            
            <!-- Authentication Test -->
            <div class="p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-green-600">ğŸ” Authentication</h3>
                <div id="auth-status" class="mb-3 p-3 bg-gray-50 rounded text-sm">Not authenticated</div>
                <div class="space-y-2">
                    <button onclick="testAuth()" class="w-full px-3 py-2 bg-green-500 text-white rounded text-sm">Test Auth System</button>
                </div>
            </div>

            <!-- Upload Test -->
            <div class="p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-purple-600">ğŸ“¤ Media Upload</h3>
                <div id="upload-status" class="mb-3 p-3 bg-gray-50 rounded text-sm">Ready</div>
                <div class="space-y-2">
                    <input type="file" id="fileInput" accept="image/*,video/*" class="w-full text-sm">
                    <button onclick="testUpload()" class="w-full px-3 py-2 bg-purple-500 text-white rounded text-sm">Test Upload</button>
                </div>
            </div>

            <!-- Achievements Test -->
            <div class="p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-yellow-600">ğŸ† Achievements</h3>
                <div id="achievements-status" class="mb-3 p-3 bg-gray-50 rounded text-sm">Ready</div>
                <button onclick="testAchievements()" class="w-full px-3 py-2 bg-yellow-500 text-white rounded text-sm">Test Achievements</button>
            </div>

            <!-- Points System Test -->
            <div class="p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-orange-600">â­ Points System</h3>
                <div id="points-status" class="mb-3 p-3 bg-gray-50 rounded text-sm">Ready</div>
                <button onclick="testPoints()" class="w-full px-3 py-2 bg-orange-500 text-white rounded text-sm">Test Points</button>
            </div>

            <!-- Habits Test -->
            <div class="p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-indigo-600">âœ… Habits</h3>
                <div id="habits-status" class="mb-3 p-3 bg-gray-50 rounded text-sm">Ready</div>
                <button onclick="testHabits()" class="w-full px-3 py-2 bg-indigo-500 text-white rounded text-sm">Test Habits</button>
            </div>

            <!-- Goals Test -->
            <div class="p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-red-600">ğŸ¯ Goals</h3>
                <div id="goals-status" class="mb-3 p-3 bg-gray-50 rounded text-sm">Ready</div>
                <button onclick="testGoals()" class="w-full px-3 py-2 bg-red-500 text-white rounded text-sm">Test Goals</button>
            </div>

            <!-- Nutrition Test -->
            <div class="p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-pink-600">ğŸ¥— Nutrition</h3>
                <div id="nutrition-status" class="mb-3 p-3 bg-gray-50 rounded text-sm">Ready</div>
                <button onclick="testNutrition()" class="w-full px-3 py-2 bg-pink-500 text-white rounded text-sm">Test Nutrition</button>
            </div>

            <!-- Media Access Test -->
            <div class="p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-3 text-teal-600">ğŸ–¼ï¸ Media Access</h3>
                <div id="media-status" class="mb-3 p-3 bg-gray-50 rounded text-sm">Ready</div>
                <button onclick="testMediaAccess()" class="w-full px-3 py-2 bg-teal-500 text-white rounded text-sm">Test Media Access</button>
            </div>
            
        </div>

        <!-- Test All Button -->
        <div class="mt-6 text-center">
            <button onclick="testAll()" class="px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold text-lg">ğŸš€ TEST ALL FEATURES</button>
        </div>
        
        <!-- Log Output -->
        <div id="logs" class="mt-6 border p-4 bg-black text-green-400 font-mono text-sm max-h-96 overflow-y-auto">
            <div>ğŸš€ StriveTrack Feature Testing Ready!</div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://strivetrack-media-api.iamhollywoodpro.workers.dev/api';
        let authToken = null;
        
        function log(message) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `<div>[${time}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(section, message, success = true) {
            const statusDiv = document.getElementById(`${section}-status`);
            const color = success ? 'text-green-600' : 'text-red-600';
            const icon = success ? 'âœ…' : 'âŒ';
            statusDiv.innerHTML = `<div class="${color}">${icon} ${message}</div>`;
        }

        async function testAuth() {
            log('ğŸ” Testing Authentication System...');
            
            try {
                // Create test account
                const email = `test-${Date.now()}@strivetrack.test`;
                const password = 'TestPass123!';
                
                log(`ğŸ“ Creating account: ${email}`);
                
                const response = await fetch(`${API_BASE}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password, name: 'Test User' })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.token;
                    log(`âœ… Authentication successful! User: ${data.user.email}`);
                    updateStatus('auth', `Authenticated as ${data.user.email}`, true);
                    return true;
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                log(`âŒ Auth test failed: ${error.message}`);
                updateStatus('auth', `Auth failed: ${error.message}`, false);
                return false;
            }
        }

        async function testUpload() {
            if (!authToken) {
                log('âš ï¸ Please run auth test first');
                return false;
            }
            
            log('ğŸ“¤ Testing Media Upload...');
            
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files[0]) {
                // Create a test file
                const testContent = 'Test image content for StriveTrack upload test';
                const testFile = new File([testContent], 'test-upload.jpg', { type: 'image/jpeg' });
                
                try {
                    const response = await fetch(`${API_BASE}/upload`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'x-file-name': testFile.name,
                            'Content-Type': testFile.type
                        },
                        body: testFile
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        log(`âœ… Upload successful! Key: ${result.key}`);
                        updateStatus('upload', `Upload successful: ${result.key}`, true);
                        return true;
                    } else {
                        const error = await response.text();
                        throw new Error(error);
                    }
                } catch (error) {
                    log(`âŒ Upload test failed: ${error.message}`);
                    updateStatus('upload', `Upload failed: ${error.message}`, false);
                    return false;
                }
            }
        }

        async function testAchievements() {
            if (!authToken) {
                log('âš ï¸ Please run auth test first');
                return false;
            }
            
            log('ğŸ† Testing Achievements System...');
            
            try {
                const response = await fetch(`${API_BASE}/achievements`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… Achievements loaded: ${data.achievements?.length || 0} achievements, ${data.totalPoints || 0} points`);
                    updateStatus('achievements', `${data.achievements?.length || 0} achievements, ${data.totalPoints || 0} points`, true);
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ Achievements test failed: ${error.message}`);
                updateStatus('achievements', `Failed: ${error.message}`, false);
                return false;
            }
        }

        async function testPoints() {
            return await testAchievements(); // Points are part of achievements
        }

        async function testHabits() {
            if (!authToken) {
                log('âš ï¸ Please run auth test first');
                return false;
            }
            
            log('âœ… Testing Habits System...');
            
            try {
                const response = await fetch(`${API_BASE}/habits`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… Habits loaded: ${data.habits?.length || 0} habits`);
                    updateStatus('habits', `${data.habits?.length || 0} habits loaded`, true);
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ Habits test failed: ${error.message}`);
                updateStatus('habits', `Failed: ${error.message}`, false);
                return false;
            }
        }

        async function testGoals() {
            if (!authToken) {
                log('âš ï¸ Please run auth test first');
                return false;
            }
            
            log('ğŸ¯ Testing Goals System...');
            
            try {
                const response = await fetch(`${API_BASE}/goals`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… Goals loaded: ${data.goals?.length || 0} goals`);
                    updateStatus('goals', `${data.goals?.length || 0} goals loaded`, true);
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ Goals test failed: ${error.message}`);
                updateStatus('goals', `Failed: ${error.message}`, false);
                return false;
            }
        }

        async function testNutrition() {
            if (!authToken) {
                log('âš ï¸ Please run auth test first');
                return false;
            }
            
            log('ğŸ¥— Testing Nutrition System...');
            
            try {
                const today = new Date().toISOString().slice(0, 10);
                const response = await fetch(`${API_BASE}/nutrition?date=${today}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… Nutrition loaded: ${data.entries?.length || 0} entries for today`);
                    updateStatus('nutrition', `${data.entries?.length || 0} entries for today`, true);
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ Nutrition test failed: ${error.message}`);
                updateStatus('nutrition', `Failed: ${error.message}`, false);
                return false;
            }
        }

        async function testMediaAccess() {
            if (!authToken) {
                log('âš ï¸ Please run auth test first');
                return false;
            }
            
            log('ğŸ–¼ï¸ Testing Media Access...');
            
            try {
                const response = await fetch(`${API_BASE}/media`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… Media access working: ${data.media?.length || 0} media files`);
                    updateStatus('media', `${data.media?.length || 0} media files accessible`, true);
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ Media access test failed: ${error.message}`);
                updateStatus('media', `Failed: ${error.message}`, false);
                return false;
            }
        }

        async function testAll() {
            log('ğŸš€ Starting comprehensive feature testing...');
            
            const tests = [
                { name: 'Authentication', fn: testAuth },
                { name: 'Upload', fn: testUpload },
                { name: 'Achievements', fn: testAchievements },
                { name: 'Points', fn: testPoints },
                { name: 'Habits', fn: testHabits },
                { name: 'Goals', fn: testGoals },
                { name: 'Nutrition', fn: testNutrition },
                { name: 'Media Access', fn: testMediaAccess }
            ];
            
            let passed = 0;
            let failed = 0;
            
            for (const test of tests) {
                try {
                    log(`\nğŸ§ª Running ${test.name} test...`);
                    const result = await test.fn();
                    if (result) {
                        passed++;
                    } else {
                        failed++;
                    }
                    // Small delay between tests
                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    log(`ğŸ’¥ ${test.name} test crashed: ${error.message}`);
                    failed++;
                }
            }
            
            log(`\nğŸ¯ TESTING COMPLETE!`);
            log(`âœ… Passed: ${passed}`);
            log(`âŒ Failed: ${failed}`);
            log(`ğŸ“Š Success Rate: ${Math.round((passed / (passed + failed)) * 100)}%`);
            
            if (failed === 0) {
                log(`ğŸ‰ ALL TESTS PASSED! StriveTrack is ready for production!`);
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            log('ğŸš€ StriveTrack Feature Test Suite Ready');
            // Auto-start comprehensive testing after 2 seconds
            setTimeout(() => {
                log('ğŸš€ Auto-starting comprehensive test...');
                testAll();
            }, 2000);
        });
    </script>
</body>
</html>